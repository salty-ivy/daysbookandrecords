<!-- cart_page.html -->
{% extends "base.html" %}
{% load wagtailcore_tags %}

{% block title %}Shopping Cart - Days Books & Records{% endblock %}

{% block content %}
<div class="page-container">
    <div class="container">
        <div class="page-header">
            <h1 class="page-title">Shopping Cart</h1>
            <p class="page-intro">Review your selected items</p>
        </div>
        
        <div class="cart-content">
            <div id="cart-items-container">
                <!-- Cart items will be loaded here via JavaScript -->
            </div>
            
            <div id="empty-cart-message" class="empty-cart" style="display: none;">
                <div class="empty-cart-content">
                    <h2>Your cart is empty</h2>
                    <p>Start shopping to add items to your cart</p>
                    <div class="empty-cart-actions">
                        <a href="/used-books/" class="btn btn-primary">Browse Used Books</a>
                        <a href="/new-books/" class="btn btn-outline">Browse New Books</a>
                        <a href="/records/" class="btn btn-tertiary">Browse Records</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        loadCartItems();
    });
    
    function loadCartItems() {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        const container = document.getElementById('cart-items-container');
        const emptyMessage = document.getElementById('empty-cart-message');
        
        if (cart.length === 0) {
            container.style.display = 'none';
            emptyMessage.style.display = 'block';
            return;
        }
        
        container.style.display = 'block';
        emptyMessage.style.display = 'none';
        
        let cartHTML = '';
        let totalPrice = 0;
        
        cart.forEach((item, index) => {
            const itemTotal = item.price * item.quantity;
            totalPrice += itemTotal;
            
            cartHTML += `
                <div class="cart-item" data-index="${index}">
                    <div class="cart-item-image">
                        ${item.image ? 
                            `<img src="${item.image}" alt="${item.title}" class="cart-item-cover">` : 
                            `<div class="cart-item-placeholder">
                                <span>${item.title.charAt(0)}</span>
                             </div>`
                        }
                    </div>
                    <div class="cart-item-details">
                        <h3 class="cart-item-title">${item.title}</h3>
                        <p class="cart-item-creator">
                            ${item.type === 'book' ? 'by ' + (item.author || 'Unknown Author') : 'by ' + (item.artist || 'Unknown Artist')}
                        </p>
                        <span class="condition-badge condition-${item.condition.toLowerCase()}">${item.condition}</span>
                        <div class="cart-item-price">£${item.price.toFixed(2)}</div>
                    </div>
                    <div class="cart-item-quantity">
                        <label for="quantity-${index}">Qty:</label>
                        <select id="quantity-${index}" onchange="updateQuantity(${index}, this.value)">
                            ${generateQuantityOptions(item.quantity)}
                        </select>
                    </div>
                    <div class="cart-item-total">
                        £${itemTotal.toFixed(2)}
                    </div>
                    <div class="cart-item-actions">
                        <button class="btn btn-small btn-outline" onclick="removeFromCart(${index})">Remove</button>
                    </div>
                </div>
            `;
        });
        
        // Add cart summary
        cartHTML += `
            <div class="cart-summary">
                <div class="cart-summary-row">
                    <span class="cart-summary-label">Total Items:</span>
                    <span class="cart-summary-value">${cart.reduce((sum, item) => sum + item.quantity, 0)}</span>
                </div>
                <div class="cart-summary-row">
                    <span class="cart-summary-label">Total Price:</span>
                    <span class="cart-summary-value cart-total-price">£${totalPrice.toFixed(2)}</span>
                </div>
                <div class="cart-summary-actions">
                    <button class="btn btn-primary btn-large" onclick="checkout()">Proceed to Checkout</button>
                    <button class="btn btn-outline btn-large" onclick="clearCart()">Clear Cart</button>
                </div>
            </div>
        `;
        
        container.innerHTML = cartHTML;
    }
    
    function generateQuantityOptions(currentQuantity) {
        let options = '';
        for (let i = 1; i <= 10; i++) {
            options += `<option value="${i}" ${i === currentQuantity ? 'selected' : ''}>${i}</option>`;
        }
        return options;
    }
    
    function updateQuantity(index, newQuantity) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        if (cart[index]) {
            cart[index].quantity = parseInt(newQuantity);
            localStorage.setItem('cart', JSON.stringify(cart));
            loadCartItems();
            updateCartBadge(cart.length);
        }
    }
    
    function removeFromCart(index) {
        const cart = JSON.parse(localStorage.getItem('cart')) || [];
        cart.splice(index, 1);
        localStorage.setItem('cart', JSON.stringify(cart));
        loadCartItems();
        updateCartBadge(cart.length);
    }
    
    function clearCart() {
        if (confirm('Are you sure you want to clear your cart?')) {
            localStorage.removeItem('cart');
            loadCartItems();
            updateCartBadge(0);
        }
    }
    
    function checkout() {
        alert('Checkout functionality would be implemented here. For now, this is a demo cart.');
    }
    
    function updateCartBadge(count) {
        const cartBadge = document.getElementById('cart-badge');
        if (cartBadge) {
            cartBadge.textContent = count;
            cartBadge.style.display = count > 0 ? 'flex' : 'none';
        }
    }
</script>
{% endblock %}
